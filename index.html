<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peta Interaktif - Modifikasi</title>
    <link rel="stylesheet" href="lib/leaflet/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    <style>
        #map { 
            height: 75vh; 
        }
        .leaflet-popup-content {
            width: 500px;
        }
        .popup-images {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            justify-content: space-between;
        }
        .popup-images img {
            width: 70%;
            max-width: 640px;
            height: auto;
        }
        h1, h2 {
            font-family: 'Poppins', sans-serif;
            text-align: center;
            margin-top: 10px;
        }
        h1 {
            font-size: 2.5em;
            background: linear-gradient(45deg, #ff7f50, #ff6347);
            color: transparent;
            background-clip: text;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.4);
            animation: fadeIn 1s ease-in-out;
        }
        h2 {
            font-size: 1.5em;
            color: #235;
            margin-bottom: 20px;
        }
        @keyframes fadeIn {
            0% { opacity: 0; transform: translateY(-30px); }
            100% { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <h1>Persebaran Jembatan Provinsi Jawa Barat</h1>
    <h2>BBPJN DKI Jakarta - Jawa Barat</h2>
    <div id="map"></div>

    <script src="lib/leaflet/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <script src="data/JabarS1SKJ2024.js"></script>
    <script src="data/JembatanJabar.js"></script>

    <script>
        // Ikon Kustom
        var geoLocationIcon = L.icon({
            iconUrl: 'data/output-onlinegiftools.gif',
            iconSize: [40, 40],
            iconAnchor: [20, 40],
            popupAnchor: [0, -40]
        });

        var jembatanIcon = L.icon({
            iconUrl: 'data/icons8-location-48.png',
            iconSize: [30, 30],
            iconAnchor: [15, 30],
            popupAnchor: [0, -30]
        });

        // Inisialisasi peta
        var map = L.map('map', {
            center: [-6.920042, 107.619203],
            zoom: 12,
            minZoom: 11
        });

        // Tambahkan layer peta dasar
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors, &copy; CARTO'
        }).addTo(map);

        // Tambahkan Geocoder
        L.Control.geocoder().addTo(map);

        // Fungsi untuk menambahkan jalur GeoJSON
        function addGeoJSONLayer(data, options) {
            L.geoJSON(data, options).addTo(map);
        }

        // Tambahkan data jalur
        if (typeof jalnas !== "undefined") {
            addGeoJSONLayer(jalnas, {
                style: function(feature) {
                    var linkId = feature.properties?.LINKID || 0;
                    var colors = ['red', 'green', 'blue', 'orange', 'purple', 'brown', 'pink', 'cyan'];
                    var color = colors[linkId % colors.length];
                    return { color: color, weight: 5, opacity: 0.6 };
                },
                onEachFeature: function(feature, layer) {
                    if (feature.properties) {
                        layer.bindPopup(`
                            <b>LINKID:</b> ${feature.properties.LINKID || "Tidak tersedia"}<br>
                            <b>Nama Ruas:</b> ${feature.properties.Nama_Ruas || "Tidak tersedia"}
                        `);
                    }
                }
            });
        } else {
            console.warn("Data jalnas tidak ditemukan.");
        }

        // Tambahkan data jembatan
        if (typeof jembatanjabar !== "undefined") {
            addGeoJSONLayer(jembatanjabar, {
                pointToLayer: function(feature, latlng) {
                    return L.marker(latlng, { icon: jembatanIcon });
                },
                onEachFeature: function(feature, layer) {
                    if (feature.properties) {
                        layer.bindPopup(`
                            <b>Nama Jembatan:</b> ${feature.properties.Nama_Jembatan || "Tidak tersedia"}<br>
                            <b>Lokasi:</b> ${feature.properties.Latitude || "N/A"}, ${feature.properties.Longitude || "N/A"}
                        `);
                    }
                }
            });
        } else {
            console.warn("Data jembatanjabar tidak ditemukan.");
        }

		// Geolokasi pengguna
		if ('geolocation' in navigator) {
			let userMarker;
			navigator.geolocation.watchPosition(
				(position) => {
					const { latitude, longitude } = position.coords;
					if (!userMarker) {
						userMarker = L.marker([latitude, longitude], { 
							icon: geoLocationIcon,
							zIndexOffset: 1000 // Menjadikan ikon ini di atas ikon lainnya
						})
						.addTo(map)
						.bindPopup("Lokasi Anda");
					} else {
						userMarker.setLatLng([latitude, longitude]);
					}
				},
				(error) => {
					console.error("Geolokasi gagal:", error);
				},
				{ enableHighAccuracy: true, maximumAge: 0, timeout: 10000 }
			);
		} else {
			alert("Browser Anda tidak mendukung Geolokasi.");
		}
    </script>
</body>
</html>
